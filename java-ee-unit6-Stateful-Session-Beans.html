<!DOCTYPE html>
<html lang="en">
<head>
    <title>Μαθαίνω Java EE</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- FontAwesome CSS -->
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- ElegantFonts CSS -->
    <link rel="stylesheet" href="css/elegant-fonts.css">

    <!-- themify-icons CSS -->
    <link rel="stylesheet" href="css/themify-icons.css">

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="css/swiper.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="java_ee_style.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150900548-1"></script>
 <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150900548-1');
</script>

</head>
<body class="single-blog-post">
    <div class="page-header">
           <header class="site-header">
            <div class="top-header-bar">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12 col-lg-6 d-none d-md-flex flex-wrap justify-content-center justify-content-lg-start mb-3 mb-lg-0">
                            <div class="header-bar-email d-flex align-items-center">
                                <i class="fa fa-envelope"></i><a href="#">michail.kassapoglou@gmail.com</a>
                            </div><!-- .header-bar-email -->

                            <div class="header-bar-text lg-flex align-items-center">
                              <!--  <p><i class="fa fa-phone"></i>001-1234-88888 </p> -->
                            </div><!-- .header-bar-text -->
                        </div><!-- .col -->

                        <div class="col-12 col-lg-6 d-flex flex-wrap justify-content-center justify-content-lg-end align-items-center">
                            <div class="header-bar-search">
                                <form class="flex align-items-stretch">
                                 <!--   <input type="search" placeholder="What would you like to learn?"> -->
                                 <!--   <button type="submit" value="" class="flex justify-content-center align-items-center"><i class="fa fa-search"></i></button> -->
                                </form>
                            </div><!-- .header-bar-search -->

                            <div class="header-bar-menu">
                                <ul class="flex justify-content-center align-items-center py-2 pt-md-0">
                                  <!--  <li><a href="#">Register</a></li> -->
                                <!--    <li><a href="#">Login</a></li> -->
                                </ul>
                            </div><!-- .header-bar-menu -->
                        </div><!-- .col -->
                    </div><!-- .row -->
                 </div>   <!-- .container-fluid -->
            </div><!-- .top-header-bar -->

            <div class="nav-bar">
                <div class="container">
                    <div class="row">
                        <div class="col-9 col-lg-3">
                            <div class="site-branding">
                                <h1 class="site-title"><a href="https://kassapoglou.github.io/main/" rel="home">Kassa<span>poglou</span></a></h1>
                            </div><!-- .site-branding -->
                        </div><!-- .col -->

                        <div class="col-3 col-lg-9 flex justify-content-end align-content-center">
                            <nav class="site-navigation flex justify-content-end align-items-center">
                                <ul class="flex flex-column flex-lg-row justify-content-lg-end align-content-center">
                                    <li class="current-menu-item"><a href="index.html">Home</a></li>
                              <li><a href="https://kassapoglou.github.io/main/forum.html">Forum</a></li>
                                    <li><a href="https://kassapoglou.github.io/main/contact.html">Contact</a></li>
                                </ul>

                                <div class="hamburger-menu d-lg-none">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div><!-- .hamburger-menu -->

                               
                            </nav><!-- .site-navigation -->
                        </div><!-- .col -->
                    </div><!-- .row -->
                </div><!-- .container -->
            </div><!-- .nav-bar -->
        </header><!-- .site-header -->

        <div class="page-header-overlay">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <header class="entry-header">
                            <h1 class="entry-title">ΕΝΟΤΗΤΑ 6 JAVA EE - Stateful Session Beans</h1>

                            <div class="entry-meta flex justify-content-center align-items-center">
                                <div class="post-author"><a href="#">Michail Kassapoglou </a></div>

                              <!--  <div class="post-comments"><a href="#">02 Comments</a></div> -->
                            </div><!-- .entry-meta -->
                        </header><!-- .entry-header -->
                    </div><!-- .col -->
                </div><!-- .row -->
            </div><!-- .container -->
        </div><!-- .page-header-overlay -->
    </div><!-- .page-header -->

    <div class="container">
        <div class="row">
            <div class="col-12 offset-lg-1 col-lg-10">
                <div class="featured-image">
                  <!--  <img src="images/single-post.jpg" alt=""> -->

                    <div class="posted-date position-absolute">
                        <div class="day">09</div>
                        <div class="month">Dec</div>
                    </div><!-- .posted-date -->
                </div><!-- .featured-image -->
            </div><!-- .col -->
        </div><!-- .row -->

        <div class="row">
            <div class="col-12 offset-lg-1 col-lg-1" style="height:0">
                <div class="post-share">
                   

                  
                </div><!-- .post-share -->
            </div><!-- .col -->

            <div class="col-12 col-lg-12">
                <div class="single-post-wrap">
                    
                    <p>Στην σημερινή δωρεάν Java EE 8 ενότητα θα ασχοληθούμε 
                        με τα Stateful Beans. Σε αντίθεση με τα Stateless 
                        Session Beans, τα Stateful Session Beans διατηρούν την 
                        επικοινωνία με τον client και θυμούνται όλες τις προηγούμενες 
                        καταστάσεις του αντικειμένου που άλλαξαν μέσω ενός ή περισσοτέρων
                        αιτημάτων στις μεθόδους του Bean.</p>
                    
                    <p>Ένα Stateful Session Bean δεν μοιράζεται ανάμεσα στους clients οπότε 
                        η σύνδεση (reference) του client με το Bean αντικείμενο θα
                        τερματίσει μόνο όταν ο client σταματήσει την επικοινωνία ή λήξει 
                        ο χρόνος ένωσης (session timeout). Αυτός είναι άλλωστε και ο λόγος
                        που η χρήση τους σε εφαρμογές με πάρα πολλούς χρήστες πρέπει 
                        να γίνεται προσεχτικά γιατί για κάθε online χρήστη θα υπάρχει 
                        και ένα bean αποκλειστικά για αυτόν για όσο παραμένει συνδεδεμένος.
                        Αν θυμάστε στα Stateless Session Beans είχαμε ένα αριθμό beans τα 
                        οποία όλοι οι χρήστες μοιραζόντουσαν. Δηλαδή, το ίδιο bean μπορεί 
                        να εξυπηρετούσε έναν διαφορετικό χρήστη κάθε φορά ή τον ίδιο. Νομίζω 
                        ότι τουλάχιστον θεωρητικά μπορείτε να καταλάβετε την διαφορά τώρα.</p>
                    
                    <p>Το κλασικό παράδειγμα ενός Stateful Session Bean είναι το
                        ηλεκτρονικό καλάθι αγοράς. Ο χρήστης προσθέτει ένα η περισσότερα
                        αντικείμενα σε ένα καλάθι αγορών, ενδεχομένως για μεγάλο χρονικό
                        διάστημα, ενώ ο χρήστης επισκέπτεται άλλους ιστότοπους. Τέλος, ο χρήστης
                        μπορεί να αποφασίσει να αγοράσει τα περιεχόμενα του καλαθιού, να ακυρώσει
                        την αγορά, η να εγκαταλείψει απότομα το site χωρίς να τερματίσει επίσημα 
                        την διαδικασία αγοράς.</p>
                    
                    <p>Όπως και στα Stateless Session Bean, έτσι και στα Stateful 
                        Session Beans υπάρχουν annotations που υποδηλώνουν κάποιες συγκεκριμένες
                        λειτουργίες. Δύο από αυτά είναι ακριβώς τα ίδια με τα εκείνα του Stateless Session
                        Bean (@PostConstruct και @PreDestroy). Υπάρχουν όμως δύο ακόμα για το Stateful 
                        Session Bean που ολοκληρώνουν το lifecycle του – @PreActivate και @PrePassivate.
                        Τα δύο αυτά annotations δεν χρησιμοποιούνται συχνά, μάλλον θα έλεγα σχεδόν καθόλου.
                        Ας δώσουμε μια γρήγορη περιγραφή σε κάθε ένα από αυτά πριν προχωρήσουμε.</p>
                    
                    <p><strong>@PostConstruct </strong>– η μέθοδος που έχει αυτό το annotation
                        θα εκτελεστεί μετά την δημιουργία του bean αντικειμένου και πριν 
                        καλέσουμε την πρώτη business μέθοδο του bean.</p>
                    
                    <p><strong>@PreDestroy</strong> – Η εκτέλεση της μεθόδου που έχει αυτό
                        το annotation θα ολοκληρωθεί μετά από οποιαδήποτε μέθοδο έχει το 
                        annotation @Remove και πριν το αντικείμενο αφαιρεθεί από τον container 
                        του Application Server. Το annotation @Remove είναι πολύ χρήσιμο σε 
                        μεθόδους του Stateful Session Beans γιατί όταν εκτελεστεί η μέθοδος,
                        ο EJB container του application server θα αφαιρέσει το bean αντικείμενο 
                        από το object pool – δηλαδή από τον αριθμό των beans που είναι διαθέσιμα 
                        στην μνήμη.</p>
                    
                    <p><strong>@PrePassivate</strong> – Μέθοδοι με αυτό το annotation θα απενεργοποιηθούν 
                        και η κατάστασή τους (state) θα αποθηκευτούν σε προσωρινή μνήμη 
                        (cache) όταν δεν έχουν χρησιμοποιηθεί για αρκετό καιρό (παραμένουν idle). 
                        Αυτή η διαδικασία επίσημα ονομάζεται passivation και απλά σημαίνει ότι
                        αποθηκεύεται το αντικείμενο από την μνήμη στο σκληρό δίσκο.</p>
                    
                    <p><strong>@PostActivate </strong>– Μέθοδοι με αυτό το annotation
                        ενεργοποιούνται πίσω όλες οι μέθοδοι που βρισκόντουσαν στην 
                        προσωρινή μνήμη (cache) όταν ο χρήστης καλεί το Stateful Session 
                        Bean. Τα δύο τελευταία annotations υπάρχουν για να γίνει μια καλύτερη 
                        διαχείριση της μνήμης όταν χρησιμοποιούνται Stateful Session Beans.</p>
                    
                    <p>Στο πιο κάτω παράδειγμα, θα δείτε το κλασικό πρόγραμμα 
                        ενός καλαθιού αγοράς για ένα online βιβλιοπωλείο. Δημιουργούμε
                        ένα Web project με το όνομα StatefulBeanExample. Προσθέτουμε 
                        το beans.xml για να ενεργοποιηθεί το injection. Αλλάζουμε τον 
                        κώδικα του index.html στον παρακάτω κώδικα:</p>
                    
                    <p><strong>index.html</strong></p>
                     <pre class="prettyprint">
 <xmp>
<!DOCTYPE html>
<html>
    <head>
        <title>Bookstore</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" 
              integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" 
              crossorigin="anonymous">
    </head>
    <body>
        <h1>Bookstore</h1>
       
        <form method="POST" action="MyServlet">
            <table>
               
           
            <tr>
                <div class="form-group">
                <td><label for="mybook">What is your favorite book? </label></td>
                <td><select id="nybook" name="mybook">
                <option value="Ulysses">Ulysses</option>
                <option value="Don Quixote">Don Quixote</option>
                <option value="Moby Dick">Moby Dick </option>
            
            </select>
                </div>
            </tr>
   
    <tr>
        <td><input type="submit" class="btn btn-primary mb-2" value="Add Item" name="add"/></td>
    </tr>
     <tr>
        <td><input type="submit" class="btn btn-primary mb-2" value="Delete Item" name="delete"/></td>
    </tr>
     <tr>
        <td><input type="submit" class="btn btn-primary mb-2" value="Browse Basket Items" name="browse"/></td>
    </tr>
     <tr>
        <td><input type="submit" class="btn btn-primary mb-2" value="Clear Basket Items" name="clear"/></td>
    </tr>
            </table>
        </form>
    
    </body>
</html>
</xmp></pre>
                    
                    <p><a><img src="java-ee-unit6/java-ee-unit6-1.JPG" alt="" class="center"></a></p>
                    
                    <p>Έχουμε δημιουργήσει μια απλή φόρμα η οποία περιλαμβάνει τέσσερα κουμπιά –
                        το Add Item, Delete Item, Browse Basket Items και Clear Basket
                        Items. Κάθε ένα από αυτά τα κουμπιά καλούν διαφορετικές μεθόδους
                        του Stateful Session Bean. Για να μπορέσουμε όμως να καλέσουμε τις
                        μεθόδους του Stateful Session Bean, θα χρειαστεί να περάσουμε πρώτα 
                        από ένα Servlet το οποίο έχει την ικανότητα και δυνατότητα να διαβάζει
                        τις html εντολές και μετά να καλεί τον αντίστοιχο Java κώδικα. Οπότε
                        δημιουργούμε ένα πακέτο με το όνομα com.mycompany, και μέσα στο
                        πακέτο δημιουργούμε ένα Servlet με το όνομα MyServlet, και ένα BasketBean. </p>
                    
                     <p><strong>BasketBean.java</strong></p>
                     <pre class="prettyprint">
 <xmp>
package com.mycomany;

import java.util.ArrayList;
import java.util.List;
import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import javax.ejb.Stateful;

@Stateful
public class BasketBean {

        
   List<String> contents;
   
   @PostConstruct
    public void initialize(){
        contents = new ArrayList<>();
    }

    public void addBook(String title) {
        contents.add(title);
    }


    public void removeBook(String title){
        boolean result = contents.remove(title);
    }


    public List<String> getContents() {
        return contents;
    }

    
    public void remove() {
        contents.clear();
    }
    
    @PreDestroy
    public void destroy(){
        System.out.println("Cleaning up all resources before shut down");
    }
}


</xmp></pre>
                     
                                          <p><strong>BasketBean.java</strong></p>
                     <pre class="prettyprint">
 <xmp>
package com.mycomany;

import java.io.IOException;
import java.io.PrintWriter;
import javax.inject.Inject;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 *
 * @author mkassapoglou
 */
public class MyServlet extends HttpServlet {

    @Inject
    BasketBean basket;


    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8");
        try (PrintWriter out = response.getWriter()) {
            
            if (request.getParameter("add") != null) {
  

            
              String name = request.getParameter("myname");
            String book = request.getParameter("mybook");
            
            if (book.contains("Ulysses")) {
            basket.addBook("Ulysses");
            }
            
             if (book.equals("Don Quixote")) {
            basket.addBook("Don Quixote");
            }
             
             
            if (book.equals("Moby Dick")) {
            basket.addBook("Moby Dick");
            }
            
            }
            else if(request.getParameter("delete") != null){
                
           
            String book = request.getParameter("mybook");
            
            if (book.contains("Ulysses")) {
            basket.removeBook("Ulysses");
            }
            
             if (book.equals("Don Quixote")) {
            basket.removeBook("Don Quixote");
            }
             
             
            if (book.equals("Moby Dick")) {
            basket.removeBook("Moby Dick");
            }
            }  
            
            else if(request.getParameter("browse") != null){
                
            
            }
            
            else if(request.getParameter("clear") != null){
                
            basket.remove();
            }
            
            
            
            /* TODO output your page here. You may use following sample code. */
            out.println("<!DOCTYPE html>");
            out.println("<html>");
            out.println("<head>");
            out.println("<title>Flight Reservation</title>");            
            out.println("</head>");
            out.println("<body>");
            out.println("<p>Your book list is: " + basket.getContents());
            out.println("<p/>");
            out.println("<a href='index.html'>Add another book</a>");
            out.println("</body>");
            out.println("</html>");
        }
    }

    // <editor-fold defaultstate="collapsed" desc="HttpServlet methods. Click on the + sign on the left to edit the code.">
    /**
     * Handles the HTTP <code>GET</code> method.
     *
     * @param request servlet request
     * @param response servlet response
     * @throws ServletException if a servlet-specific error occurs
     * @throws IOException if an I/O error occurs
     */
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
            processRequest(request, response);
    }

    /**
     * Handles the HTTP <code>POST</code> method.
     *
     * @param request servlet request
     * @param response servlet response
     * @throws ServletException if a servlet-specific error occurs
     * @throws IOException if an I/O error occurs
     */
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException{
            processRequest(request, response);
    }

    /**
     * Returns a short description of the servlet.
     *
     * @return a String containing servlet description
     */
    @Override
    public String getServletInfo() {
        return "Short description";
    }// </editor-fold>

}
</xmp></pre>
                    
                                          <p>Το MyServlet διαβάζει την παράμετρο name του κουμπιού που
                                              έχει ενεργοποιηθεί και εκτελεί την αντίστοιχη μέθοδο από 
                                              το Bean. Για παράδειγμα, αν έχουμε πατήσει το κουμπί Add
                                              Item, του οποίου η name παράμετρος είναι add, τότε αφού
                                              επιλέξουμε πιο βιβλίο θέλουμε να προσθέσουμε στην λίστα,
                                              θα καλέσουμε την μέθοδο addbook( ) για να το προσθέσει.
                                              Αντίστοιχα το κουμπί Delete Item με name παράμετρο delete
                                              θα αφαιρέσει το βιβλίο που έχουμε επιλέξει από την λίστα.
                                              Το Browse Basket Items μας δείχνει όλα τα βιβλία που έχουμε
                                              ήδη στο καλάθι αγοράς μας, ενώ το Clear Basket Items καθαρίζει 
                                              το καλάθι αγοράς για να ξεκινήσουμε την διαδικασία από την αρχή.</p>
                                          
                                          <p>Στο κώδικα του BasketBean, το πρώτο πράγμα που θα παρατηρήσετε 
                                              είναι το annotation @Stateful το οποίο χαρακτηρίζει το Bean 
                                              σαν Stateful Session Bean. Οι @PostConstruct και @PostDestroy 
                                              μέθοδοι λειτουργούν ακριβώς με τον ίδιο τρόπο όπως και στα 
                                              Stateless Session Bean. </p>
                                          
                                          <p>Τέλος, επειδή ακόμα δεν έχουμε μάθει να γράφουμε και 
                                              να διαβάζουμε από μια βάση με την χρήση του JPA framework,
                                              απλά χρησιμοποιούμε ένα ArrayList με το όνομα contents για 
                                              να παίξει το ρόλο της βάσης.</p>    
                                          
                                <p><a><img src="java-ee-unit6/java-ee-unit6-2.JPG" alt="" class="center"></a></p>          
                                <p><a><img src="java-ee-unit6/java-ee-unit6-3.JPG" alt="" class="center"></a></p> 
                                <p><a><img src="java-ee-unit6/java-ee-unit6-4.JPG" alt="" class="center"></a></p> 
                                 <p><a><img src="java-ee-unit6/java-ee-unit6-5.JPG" alt="" class="center"></a></p> 
                                  <p><a><img src="java-ee-unit6/java-ee-unit6-6.JPG" alt="" class="center"></a></p>
                                    <p><a><img src="java-ee-unit6/java-ee-unit6-7.JPG" alt="" class="center"></a></p>
                                   <p><a><img src="java-ee-unit6/java-ee-unit6-8.JPG" alt="" class="center"></a></p>
                                    <p><a><img src="java-ee-unit6/java-ee-unit6-9.JPG" alt="" class="center"></a></p>
                                     <p><a><img src="java-ee-unit6/java-ee-unit6-10.JPG" alt="" class="center"></a></p>
                                     <p><a><img src="java-ee-unit6/java-ee-unit6-11.JPG" alt="" class="center"></a></p>
                                     <p><a><img src="java-ee-unit6/java-ee-unit6-12.JPG" alt="" class="center"></a></p>


             

           

                <div class="author-box">
                    <div class="author-info flex flex-wrap">
                        <div class="author-avatar">
                            <img src="images/michail.jpg" alt="">

                           
                        </div><!-- .author-avatar -->

                        <div class="author-details">
                            <h3 class="author-name">Michail Kassapoglou <span>Admin</span></h3>

                            <div class="entry-content mt-3">
                                <p>Γεια σας, είμαι ο Μιχάλης Κασάπογλου και θα σας διδάξω με τον ποιο απλό 
                                  τρόπο να προγραμματίζετε σε Java EE. Ασχολούμαι με την τεχνική εκπαίδευση 
                                    σε διάφορες πλατφόρμες, λειτουργικά συστήματα και γλώσσες προγραμματισμού 
                                    πάνω από 20 έτη. Κατέχω έναν αρκετά μεγάλο αριθμό πιστοποιήσεων Microsoft και Oracle 
                                    και σαν Τraining Lead στην Intrasoft έχω την δυνατότητα να αναβαθμίζω συνεχώς 
                                    τις γνώσεις μου και να έχω άμεση επαφή με αληθινά projects και εξειδικευμένες μεθόδους 
                                    ανάπτυξης εφαρμογών που έχουν υψηλές απαιτήσεις.  
                                    Για τυχόν ερωτήσεις σας μπορείτε να επικοινωνήσετε μαζί μου 
                                    στο <font color="#0000CC">Michail.Kassapoglou@gmail.com </font></p>
                             <p>   Σας ευχαριστώ που επισκεφτήκατε την ιστοσελίδα μου.</p>
                            </div><!-- .entry-content -->
                        </div><!-- .author-details -->
                    </div><!-- .author-info -->
                </div><!-- .author-box -->

                
            </div><!-- .col -->
        </div><!-- .row -->
    </div><!-- .container -->

 

  

    <script type='text/javascript' src='js/jquery.js'></script>
    <script type='text/javascript' src='js/swiper.min.js'></script>
    <script type='text/javascript' src='js/masonry.pkgd.min.js'></script>
    <script type='text/javascript' src='js/jquery.collapsible.min.js'></script>
    <script type='text/javascript' src='js/custom.js'></script>

</body>
</html>
